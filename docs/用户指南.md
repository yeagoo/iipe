# iipe PHP å¤šç‰ˆæœ¬ä»“åº“ç”¨æˆ·æŒ‡å—

## ğŸš€ é¡¹ç›®ç®€ä»‹

**iipe** æ˜¯ä¸€ä¸ªä¸ºç°ä»£ä¼ä¸š Linux ç”Ÿæ€æä¾› PHP å…¨ç”Ÿå‘½å‘¨æœŸç‰ˆæœ¬æ”¯æŒçš„ SCL (Software Collection) é£æ ¼è½¯ä»¶ä»“åº“ã€‚æ”¯æŒä» PHP 7.4 åˆ° 8.5 çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œè¦†ç›–ä¸»æµ Linux å‘è¡Œç‰ˆã€‚

### æ”¯æŒçš„ç³»ç»Ÿ

- **RHEL 9 å®¶æ—**: AlmaLinux 9, Oracle Linux 9, Rocky Linux 9, RHEL 9, CentOS Stream 9
- **RHEL 10 å®¶æ—**: AlmaLinux 10, Oracle Linux 10, Rocky Linux 10, RHEL 10, CentOS Stream 10  
- **å…¶ä»–å‘è¡Œç‰ˆ**: openEuler 24.03-LTS, openAnolis 23, OpencloudOS 9

### æ”¯æŒçš„ PHP ç‰ˆæœ¬

- **PHP 7.4** - EOL ç‰ˆæœ¬ï¼Œé€‚ç”¨äºé—ç•™åº”ç”¨
- **PHP 8.0** - LTS ç‰ˆæœ¬ï¼Œç”Ÿäº§ç¯å¢ƒæ¨è
- **PHP 8.1** - LTS ç‰ˆæœ¬ï¼Œç”Ÿäº§ç¯å¢ƒæ¨è
- **PHP 8.2** - ç¨³å®šç‰ˆæœ¬
- **PHP 8.3** - å½“å‰ç¨³å®šç‰ˆæœ¬ï¼Œæ¨èæ–°é¡¹ç›®ä½¿ç”¨
- **PHP 8.4** - æœ€æ–°ç¨³å®šç‰ˆæœ¬
- **PHP 8.5** - å¼€å‘ç‰ˆæœ¬ï¼Œæå‰ä½“éªŒæ–°ç‰¹æ€§

## ğŸ“¦ å¿«é€Ÿå®‰è£…

### ç¬¬ä¸€æ­¥ï¼šå¯¼å…¥ GPG å…¬é’¥

```bash
sudo rpm --import https://ii.pe/RPM-GPG-KEY-iipe
```

### ç¬¬äºŒæ­¥ï¼šæ·»åŠ ä»“åº“é…ç½®

```bash
sudo dnf config-manager --add-repo https://ii.pe/iipe.repo
```

æˆ–è€…æ‰‹åŠ¨ä¸‹è½½ï¼š

```bash
sudo curl -o /etc/yum.repos.d/iipe.repo https://ii.pe/iipe.repo
```

### ç¬¬ä¸‰æ­¥ï¼šå¯ç”¨å¯¹åº”çš„ä»“åº“

æ ¹æ®æ‚¨çš„æ“ä½œç³»ç»Ÿå¯ç”¨ç›¸åº”çš„ä»“åº“ï¼š

```bash
# RHEL 9 ç³»åˆ— (é»˜è®¤å·²å¯ç”¨)
# AlmaLinux 9, Rocky Linux 9, Oracle Linux 9, RHEL 9, CentOS Stream 9

# RHEL 10 ç³»åˆ—
sudo dnf config-manager --enable iipe-php-rhel10

# openEuler 24.03-LTS
sudo dnf config-manager --enable iipe-php-openeuler-24.03

# openAnolis 23
sudo dnf config-manager --enable iipe-php-openanolis-23

# OpencloudOS 9
sudo dnf config-manager --enable iipe-php-opencloudos-9
```

## ğŸ”§ å®‰è£… PHP ç‰ˆæœ¬

### å®‰è£…å•ä¸ª PHP ç‰ˆæœ¬

```bash
# å®‰è£… PHP 7.4 (å®Œæ•´å¥—ä»¶)
sudo dnf install iipe-php74 iipe-php74-php-fpm iipe-php74-php-cli \
    iipe-php74-php-mysqlnd iipe-php74-php-gd iipe-php74-php-intl \
    iipe-php74-php-mbstring iipe-php74-php-opcache iipe-php74-php-xml \
    iipe-php74-php-zip

# å®‰è£… PHP 8.3 (æ¨èç”¨äºæ–°é¡¹ç›®)
sudo dnf install iipe-php83 iipe-php83-php-fpm iipe-php83-php-cli \
    iipe-php83-php-mysqlnd iipe-php83-php-gd iipe-php83-php-intl \
    iipe-php83-php-mbstring iipe-php83-php-opcache iipe-php83-php-xml \
    iipe-php83-php-zip

# å®‰è£… PHP 8.4 (æœ€æ–°ç¨³å®šç‰ˆ)
sudo dnf install iipe-php84 iipe-php84-php-fpm iipe-php84-php-cli \
    iipe-php84-php-mysqlnd iipe-php84-php-gd iipe-php84-php-intl \
    iipe-php84-php-mbstring iipe-php84-php-opcache iipe-php84-php-xml \
    iipe-php84-php-zip
```

### å®‰è£…å¤šä¸ª PHP ç‰ˆæœ¬

```bash
# åŒæ—¶å®‰è£…å¤šä¸ªç‰ˆæœ¬ï¼ˆå¸¸è§ç»„åˆï¼‰
sudo dnf install \
    iipe-php74-php-fpm iipe-php74-php-mysqlnd \
    iipe-php80-php-fpm iipe-php80-php-mysqlnd \
    iipe-php83-php-fpm iipe-php83-php-mysqlnd
```

### æŸ¥çœ‹å¯ç”¨åŒ…

```bash
# æŸ¥çœ‹æ‰€æœ‰ iipe PHP åŒ…
dnf search iipe-php

# æŸ¥çœ‹ç‰¹å®šç‰ˆæœ¬çš„æ‰©å±•
dnf list iipe-php83-*
```

## ğŸ¯ ä½¿ç”¨ SCL ç¯å¢ƒ

### ä¸´æ—¶å¯ç”¨ç‰¹å®š PHP ç‰ˆæœ¬

```bash
# å¯ç”¨ PHP 7.4
scl enable iipe-php74 -- php -v

# å¯ç”¨ PHP 8.3 å¹¶è¿è¡Œå‘½ä»¤
scl enable iipe-php83 -- php -v
scl enable iipe-php83 -- php composer.phar install

# å¯ç”¨ PHP 8.4 å¹¶è¿è¡Œè„šæœ¬
scl enable iipe-php84 -- php your-script.php
```

### åœ¨ Shell ä¸­æ°¸ä¹…å¯ç”¨

```bash
# è¿›å…¥ PHP 8.3 ç¯å¢ƒ
scl enable iipe-php83 bash

# ç°åœ¨ php å‘½ä»¤æŒ‡å‘ PHP 8.3
php -v
which php  # /opt/iipe/iipe-php83/root/usr/bin/php
```

### åœ¨è„šæœ¬ä¸­ä½¿ç”¨

```bash
#!/bin/bash
# åœ¨è„šæœ¬ä¸­å¯ç”¨ PHP 8.3
source scl_source enable iipe-php83

php -v
composer install
php artisan migrate
```

## ğŸ”§ PHP-FPM æœåŠ¡ç®¡ç†

### å¯åŠ¨å’Œç®¡ç†æœåŠ¡

```bash
# å¯åŠ¨ PHP 8.3 FPM æœåŠ¡
sudo systemctl start iipe-php83-php-fpm
sudo systemctl enable iipe-php83-php-fpm

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status iipe-php83-php-fpm

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload iipe-php83-php-fpm

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u iipe-php83-php-fpm -f
```

### åŒæ—¶è¿è¡Œå¤šä¸ªç‰ˆæœ¬

```bash
# å¯åŠ¨å¤šä¸ª PHP-FPM ç‰ˆæœ¬
sudo systemctl start iipe-php74-php-fpm
sudo systemctl start iipe-php80-php-fpm
sudo systemctl start iipe-php83-php-fpm

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable iipe-php74-php-fpm
sudo systemctl enable iipe-php80-php-fpm
sudo systemctl enable iipe-php83-php-fpm

# æŸ¥çœ‹æ‰€æœ‰ PHP-FPM è¿›ç¨‹
ps aux | grep php-fpm
```

## ğŸŒ Web æœåŠ¡å™¨é…ç½®

### Nginx é…ç½®ç¤ºä¾‹

```nginx
# PHP 7.4 ç«™ç‚¹
server {
    listen 80;
    server_name php74.example.com;
    root /var/www/php74;
    
    location ~ \.php$ {
        fastcgi_pass unix:/opt/iipe/iipe-php74/root/run/php-fpm/www.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}

# PHP 8.3 ç«™ç‚¹
server {
    listen 80;
    server_name php83.example.com;
    root /var/www/php83;
    
    location ~ \.php$ {
        fastcgi_pass unix:/opt/iipe/iipe-php83/root/run/php-fpm/www.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

### Apache é…ç½®ç¤ºä¾‹

```apache
# åŠ è½½ PHP æ¨¡å—
LoadModule php_module /opt/iipe/iipe-php83/root/usr/lib64/httpd/modules/libiipe-php83.so

# PHP 8.3 è™šæ‹Ÿä¸»æœº
<VirtualHost *:80>
    ServerName php83.example.com
    DocumentRoot /var/www/php83
    
    <FilesMatch "\.php$">
        SetHandler application/x-httpd-php
    </FilesMatch>
</VirtualHost>
```

## ğŸ’¡ å¸¸è§åº”ç”¨é…ç½®

### WordPress é…ç½®

```bash
# ä¸º WordPress å®‰è£…æ¨èçš„ PHP 8.3 é…ç½®
sudo dnf install iipe-php83-php-fpm iipe-php83-php-mysqlnd \
    iipe-php83-php-gd iipe-php83-php-intl iipe-php83-php-mbstring \
    iipe-php83-php-opcache iipe-php83-php-xml iipe-php83-php-zip

# å¯åŠ¨æœåŠ¡
sudo systemctl start iipe-php83-php-fpm
sudo systemctl enable iipe-php83-php-fpm
```

### Laravel é¡¹ç›®é…ç½®

```bash
# Laravel æ¨è PHP 8.2+
sudo dnf install iipe-php83-php-fpm iipe-php83-php-cli \
    iipe-php83-php-mysqlnd iipe-php83-php-mbstring \
    iipe-php83-php-xml iipe-php83-php-zip iipe-php83-php-opcache

# åœ¨é¡¹ç›®ç›®å½•ä¸­ä½¿ç”¨ Composer
scl enable iipe-php83 -- composer install
scl enable iipe-php83 -- php artisan key:generate
```

### ThinkPHP é…ç½®

```bash
# ThinkPHP å…¼å®¹å¤šä¸ªç‰ˆæœ¬ï¼Œæ¨èä½¿ç”¨ PHP 8.1+
sudo dnf install iipe-php81-php-fpm iipe-php81-php-cli \
    iipe-php81-php-mysqlnd iipe-php81-php-mbstring \
    iipe-php81-php-xml iipe-php81-php-opcache
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. GPG å¯†é’¥éªŒè¯å¤±è´¥

```bash
# é‡æ–°å¯¼å…¥ GPG å¯†é’¥
sudo rpm --import https://ii.pe/RPM-GPG-KEY-iipe

# æˆ–è€…ä¸´æ—¶ç¦ç”¨ GPG æ£€æŸ¥
sudo dnf install --nogpgcheck iipe-php83
```

#### 2. æ‰¾ä¸åˆ°åŒ…

```bash
# æ£€æŸ¥ä»“åº“æ˜¯å¦å¯ç”¨
dnf repolist | grep iipe

# æ¸…ç†ç¼“å­˜
sudo dnf clean all
sudo dnf makecache
```

#### 3. PHP-FPM å¯åŠ¨å¤±è´¥

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
sudo /opt/iipe/iipe-php83/root/usr/sbin/php-fpm -t

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
sudo journalctl -u iipe-php83-php-fpm -n 50
```

#### 4. SCL ç¯å¢ƒé—®é¢˜

```bash
# æ£€æŸ¥ SCL æ˜¯å¦æ­£ç¡®å®‰è£…
rpm -qa | grep scl-utils

# æ‰‹åŠ¨åŠ è½½ç¯å¢ƒ
source /opt/iipe/iipe-php83/enable
```

### æ€§èƒ½ä¼˜åŒ–

#### OPcache é…ç½®ä¼˜åŒ–

ç¼–è¾‘ `/opt/iipe/iipe-php83/root/etc/php.d/10-opcache.ini`ï¼š

```ini
[opcache]
opcache.enable=1
opcache.enable_cli=1
opcache.memory_consumption=128M
opcache.interned_strings_buffer=16
opcache.max_accelerated_files=10000
opcache.max_wasted_percentage=5
opcache.use_cwd=1
opcache.validate_timestamps=1
opcache.revalidate_freq=2
opcache.save_comments=1

; PHP 8.0+ JIT é…ç½®
opcache.jit_buffer_size=128M
opcache.jit=1255
```

## ğŸ“š å‚è€ƒèµ„æ–™

### æ–‡æ¡£é“¾æ¥

- **é¡¹ç›®ä¸»é¡µ**: https://ii.pe/
- **GitHub ä»“åº“**: https://github.com/iipe/php-repo
- **é—®é¢˜åé¦ˆ**: https://github.com/iipe/php-repo/issues

### è·¯å¾„å‚è€ƒ

```bash
# SCL æ ¹ç›®å½•
/opt/iipe/

# PHP 8.3 ç›¸å…³è·¯å¾„
/opt/iipe/iipe-php83/root/usr/bin/php      # PHP äºŒè¿›åˆ¶æ–‡ä»¶
/opt/iipe/iipe-php83/root/etc/php.ini     # ä¸»é…ç½®æ–‡ä»¶
/opt/iipe/iipe-php83/root/etc/php.d/      # æ‰©å±•é…ç½®ç›®å½•
/opt/iipe/iipe-php83/root/var/log/        # æ—¥å¿—ç›®å½•

# æœåŠ¡æ–‡ä»¶
/usr/lib/systemd/system/iipe-php83-php-fpm.service
```

### ç«¯å£å’Œ Socket

```bash
# é»˜è®¤ PHP-FPM Socket ä½ç½®
/opt/iipe/iipe-php74/root/run/php-fpm/www.sock
/opt/iipe/iipe-php80/root/run/php-fpm/www.sock
/opt/iipe/iipe-php83/root/run/php-fpm/www.sock
```

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æ“ä½œç³»ç»Ÿç‰ˆæœ¬**: `cat /etc/os-release`
2. **å·²å®‰è£…çš„ iipe åŒ…**: `rpm -qa | grep iipe`
3. **é”™è¯¯æ—¥å¿—**: `sudo journalctl -u iipe-php83-php-fpm -n 50`
4. **é…ç½®æ–‡ä»¶**: `/opt/iipe/iipe-php83/root/etc/php-fpm.conf`

è”ç³»æ–¹å¼ï¼š
- ğŸ“§ é‚®ç®±: support@ii.pe
- ğŸ› Bug æŠ¥å‘Š: https://github.com/iipe/php-repo/issues
- ğŸ’¬ è®¨è®º: https://github.com/iipe/php-repo/discussions 